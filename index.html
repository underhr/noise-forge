<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Noise Forge</title>

  <style>
    html, body {
      margin: 0;
      width: 100%;
      height: 100%;
    }

    body {
      background: black url("background.gif") center / cover no-repeat fixed;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: serif;
      transition: opacity 1s ease;
    }

    body.fade-out {
      opacity: 0;
    }

    .overlay {
      background: rgba(0,0,0,0.6);
      padding: 40px 60px;
      border: 2px solid white;
      text-align: center;
      color: white;
    }

    a {
      display: inline-block;
      margin-top: 30px;
      padding: 12px 30px;
      border: 2px solid white;
      color: white;
      text-decoration: none;
      cursor: pointer;
    }

    /* ðŸ”Š Volume Control */
    #volume-control {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0,0,0,0.6);
      padding: 8px 12px;
      border-radius: 8px;
      color: white;
      font-size: 14px;
      z-index: 9999;
    }

    #volume-slider {
      vertical-align: middle;
      margin-left: 8px;
    }
  </style>
</head>

<body>

  <!-- ðŸ”Š Background Audio (ONE instance only) -->
  <audio id="bg-audio" loop>
    <source src="assets/audio/bg_ambient.mp3" type="audio/mpeg">
  </audio>

  <!-- ðŸ” Overlay -->
  <div class="overlay">
    <h1>THE NOISE FORGE</h1>
    <a id="enter">ENTER</a>
  </div>

  <!-- ðŸ”Š Volume UI -->
  <div id="volume-control">
    ðŸ”Š
    <input
      type="range"
      id="volume-slider"
      min="0"
      max="1"
      step="0.01"
    >
  </div>

  <!-- ðŸ”§ SCRIPT (PLACED AFTER ELEMENTS â€” IMPORTANT) -->
  <script>
    const bgAudio = document.getElementById("bg-audio");
    const volumeSlider = document.getElementById("volume-slider");
    const enterButton = document.getElementById("enter");

    /* ðŸ”¹ Load saved volume */
    const savedVolume = localStorage.getItem("bgVolume");
    bgAudio.volume = savedVolume !== null ? savedVolume : 0.4;
    volumeSlider.value = bgAudio.volume;

    /* ðŸ”¹ Resume playback time */
    const savedTime = localStorage.getItem("bgTime");
    if (savedTime) {
      bgAudio.currentTime = parseFloat(savedTime);
    }

    /* ðŸ”¹ Start audio on first user interaction */
    function startAudioOnce() {
      bgAudio.play().catch(() => {});
      document.removeEventListener("click", startAudioOnce);
    }
    document.addEventListener("click", startAudioOnce);

    /* ðŸ”¹ Save volume changes */
    volumeSlider.addEventListener("input", () => {
      bgAudio.volume = volumeSlider.value;
      localStorage.setItem("bgVolume", volumeSlider.value);
    });

    /* ðŸ”¹ Continuously save playback position */
    setInterval(() => {
      if (!bgAudio.paused) {
        localStorage.setItem("bgTime", bgAudio.currentTime);
      }
    }, 500);

    /* ðŸ”¹ Fade-out transition to Puzzle 1 */
    enterButton.onclick = () => {
      document.body.classList.add("fade-out");
      setTimeout(() => {
        window.location.href = "puzzle1.html";
      }, 1000);
    };
  </script>

</body>
</html>
